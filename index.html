<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To do list</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <h1>Mes tâches</h1>
        <input id="newTask" type="text">
        <button id="saveTask">Boutton</button><button id="loadTask">Load</button>
        <ul id="ulList"></ul>
    </header>
    <script>
        
        const newTask = document.getElementById("newTask");     // Zone de texte, pour écrire les tâches
        const saveTask = document.getElementById("saveTask");   // Boutton ajout de tâche
        const loadTask = document.getElementById("loadTask");   // Boutton récupèrer données du Local storage
        let ulList = document.getElementById("ulList");         // Structure HTML qui contiendra les tâches
        let taskName;
        let varContent = [];
        let varScanner = [];
        // -----------------------------------------------------------------------------------------------------------

        saveTask.addEventListener('click', function savedTask() {
            let listVar = document.createElement("li"); // Crée un "li" (le texte de la tâche)

            if (!varScanner.find(element => element == newTask.value)) { // Assure que la Tâche que j'ai dans la zone d'Input n'éxiste pas déjà
                taskName = newTask.value;   // Récupère le contenu du Input dans taskName
                console.log("Worked if: ", varScanner.find(element => element === taskName));
                console.log(varScanner);
                newTask.value = ""; // Vide le text de la zone Input
                listVar.textContent = taskName; // le "li" récupère le texte pour crée la tâche 
                varContent.push(taskName); // Liste des tâches à save dans le LocalStorage 
                console.log('varContent :', varContent);
                if (varContent.find(element => element != "") || varContent.find(element => element != null)) {
                    localStorage.setItem('Tasks', JSON.stringify(varContent));

                    if (taskName != "") { // Si le Input est vide, ne crée pas de tâches
                        let lsList = JSON.parse(localStorage.getItem('Tasks')) || []; // Récupère et transform les données dans Local storage
                        let delPosition = lsList.indexOf(listVar.textContent); // Position à utiliser dans le .Splice()
                        console.log("Found index of searched String: ", lsList.indexOf(listVar.textContent));
                        ulList.appendChild(listVar); // Ajoute la tâche sur le site
                        newTask.focus(); // Revien automatiquement dans l'input
                        varScanner.push(listVar.textContent); // Variable à scanner dans le If, obtien son string
                        console.log("Worked 2nd: ", varScanner.find(element => element === taskName));

                        // console.log("Push: ", varScanner.push(listVar.textContent));
                        const delTask = document.createElement("button");
                        delTask.innerText = "Suppr"
                        delTask.addEventListener('click', function () { // Fonction boutton suppr
                            varContent, listVar, lsList, delPosition; // Refresh les données
                            ulList.removeChild(listVar);    // Supprime les deux éléments du HTML
                            delTask.remove();               //
                            varContent.splice(delPosition, 1); // Supprime 1 élément dans VarContent
                            console.log("VarContent (after del): ",varContent);
                            console.log('Spliced element from VarContent: ', varContent.splice(delPosition, 1));

                            varContent, listVar, lsList, delPosition; // Refresh les données
                            localStorage.setItem('Tasks', JSON.stringify(varContent)); // Actualise le LocalStorage
                            varScanner = []; // Vide VarScanner pour éviter des problèmes a suppr des valeurs
                            console.log("Found index of searched String (after deleted): ", lsList.indexOf(listVar.textContent));
                        }) // Fin fonction boutton suppr
                        ulList.appendChild(delTask); // Ajoute le boutton suppr tâche
                    } 
                } 
            } else {console.error("Pas de tâches identiques !");}
        }); // Fin fonction savedTask()

        // --------------------------------------------------------------------------------------------------
        loadTask.addEventListener('click', function loadedTask() {
            varContent = JSON.parse(localStorage.getItem(localStorage.key('Tasks')));
            for (let i = 0; i < varContent.length; i++) {
                let listVar = document.createElement("li");
                listVar.textContent = varContent[i];

                ulList.appendChild(listVar);
                const delTask = document.createElement("button");
                delTask.innerText = "Suppr"
                delTask.addEventListener('click', function () {
                    ulList.removeChild(listVar);
                    ulList.removeChild(delTask);
                })
                ulList.appendChild(delTask);
            }
        });
        // --------------------------------------------------------------------------------------------
    </script>
</body>
</html>